<style>
.form input[type='text'] {
	width: 90%;
}
</style>

<article class="exap0800 view-code" >
	<h1>마스터 그리드와 디테일 폼이 조합된 화면 예제</h1>
	<div class="intro">
		<p lang="ko_KR" class="smallContTit">마스터 그리드와 상세 수정 화면 폼을 조합한 화면 예제 입니다.</p>
		<p lang="en_US" class="smallContTit">This example is combination of  the master grid and detail form</p>
		<p lang="ko_KR" class="smallContTit">마스터 그리드와 상세 수정화면의 폼은 같은 데이터를 참고하고 있으므로 둘중 한쪽에서 데이터 변동이 있을 시 나머지 한쪽도 실시간으로 변경된 데이터가 동기화 됩니다.</p>
		<p lang="en_US" class="smallContTit">The data of master grid and detail form is synchronized each other real time because they are refer to same data.</p>
		<p class="smallContTit">서버와 연계되지 않은 UI 쪽 코딩 예제이기 때문에 검색 조건으로 입력한 데이터와 저장 데이터는 그리드에 적용되지 않습니다. 서버쪽으로 전달되는 파라미터만 확인 바랍니다.</p>
		<p class="smallContTit">데이터가 수정된 요소에는 "data_changed__" 라는 스타일 클래스가 수정된 그리드의 행에는 "row_data_changed__" 라는 스타일 클래스가 정의 됩니다. "data_changed__" 나 "row_data_changed__" 클래스에 대한 스타일을 지정하면 값이 수정된 요소나 그리드의 행을 화면에 표시 할 수 있습니다.</p>
	</div>

	<div id="subContext" style="overflow: hidden;">
		<div id="masterDiv" style="width: 30%; float: left; margin-right: 2%;">
			<div class="searchBox">
				<ul>
					<li class="inputs" style="overflow: hidden;">
						<label>Name<input id="name" type="text" data-validate='[["alphabet+integer"]]' /></label>
						<a lang="ko_KR" id="btnSearch" href="#" style="float: right; margin-right: 10px;">조회</a>
						<a lang="en_US" id="btnSearch" href="#" style="float: right; margin-right: 10px;">Retrieve</a>
					</li>
				</ul>
			</div>

			<table id="grid" class="grid" style="width: 100%;">
				<thead>
					<tr>
						<th width="20%">Index</th>
						<th width="60%">Name</th>
						<th width="20%">Active</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td id="index" align="center"></td>
						<td><input id="name" type="text" data-validate='[["required"]]' /></td>
						<td align="center"><input id="isActive" type="checkbox" /></td>
					</tr>
				</tbody>
			</table>
		</div>
		<div id="detailDiv" style="width: 68%; display: inline-block;">
			<div class="searchBox" style="padding: 1px;">
				<ul>
					<li lang="ko_KR" class="buttons">
						<a id="btnAdd" href="#" data-opts='{ "color": "green" }'>추가</a>
						<a id="btnDelete" href="#" data-opts='{ "color": "green" }'>삭제</a>
						<a id="btnSave" href="#" data-opts='{ "color": "yellowgreen" }'>저장</a>
						<a id="btnRevert" href="#" data-opts='{ "color": "white" }'>되돌리기</a>
					</li>
					<li lang="en_US" class="buttons">
						<a id="btnAdd" href="#" data-opts='{ "color": "green" }'>New</a>
						<a id="btnDelete" href="#" data-opts='{ "color": "green" }'>Delete</a>
						<a id="btnSave" href="#" data-opts='{ "color": "yellowgreen" }'>Save</a>
						<a id="btnRevert" href="#" data-opts='{ "color": "white" }'>Revert</a>
					</li>
				</ul>
			</div>

			<table id="detail" class="form" style="width: 100%;">
				<tr>
					<th rowspan="5" style="width: 15%;" align="right">picture</th>
					<td rowspan="5" style="width: 35%;" align="center" valign="middle"><img id="picture" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D" height="110" /></td>
					<th style="width: 15%;"><label for="name">Name</label></th>
					<td style="width: 35%;"><input id="name" type="text" data-validate='[["required"]]' /></td>
				</tr>
				<tr>
					<th><label for="email">Email</label></th>
					<td><input id="email" type="text" data-validate='[["required"], ["email"]]' /></td>
				</tr>
				<tr>
					<th><label for="_id">Password</label></th>
					<td><input id="_id" type="text" data-format='[["generic", "@@＊＊＊＊＊＊"]]' data-validate='[["required"]]' /></td>
				</tr>
				<tr>
					<th><label for="balance">Balance</label></th>
					<td><input id="balance" type="text" data-format='[["numeric", "$#,###.##0"]]' data-validate='[["required"], ["number"]]' /></td>
				</tr>
				<tr>
					<th><label for="phone">Phone</label></th>
					<td><input id="phone" type="text" data-validate='[["required"]]' /></td>
				</tr>
				<tr>
					<th><label for="age">Age</label></th>
					<td><input id="age" type="text" data-validate='[["required"], ["integer"]]' /></td>
					<th><label for="eyeColor">Eye color</label></th>
					<td>
						<select id="eyeColor" data-validate='[["required"]]'>
							<option lang="ko_KR">선택</option>
							<option lang="en_US">Select</option>
						</select>
					</td>
				</tr>
				<tr>
					<th rowspan="3"><label for="company">Company</label></th>
					<td rowspan="3"><select id="company" multiple="multiple" data-validate='[["required"]]' style="height: 117px;"></select></td>
					<th><label for="gender">Gender</label></th>
					<td><input id="gender" type="radio" /></td>
				</tr>
				<tr>
					<th><label for="favoriteFruit">Favorite fruit</label></th>
					<td><input id="favoriteFruit" type="checkbox" data-validate='[["required"]]' /></td>
				</tr>
				<tr>
					<th><label for="registered">Registered</label></th>
					<td><input id="registered" type="text" data-format='[["date", 8, "date"]]' data-validate='[["required"]]' /></td>
				</tr>
				<tr>
					<th><label for="about">About</label></th>
					<td colspan="3"><textarea id="about" style="width: 95%;" rows="3" data-format='[["limit", "100", "..."]]' data-validate='[["required"]]'></textarea></td>
				</tr>
				<tr>
					<th><label for="greeting">Greeting</label></th>
					<td colspan="3" id="greeting"></td>
				</tr>
				<tr>
					<th><label for="isActive">Active</label></th>
					<td colspan="3"><input id="isActive" type="checkbox" /></td>
				</tr>
			</table>
		</div>
	</div>
</article>

<script type="text/javascript">
N(".exap0800").cont({
	genderCodes: [{
    	"key" : "male",
    	"val" : "male"
	    },{
	    	"key" : "female",
	    	"val" : "female"
	}],
	eyeColorCodes: [{
	    	"key" : "blue",
	    	"val" : "blue"
	    },{
	    	"key" : "brown",
	    	"val" : "brown"
	    },{
	    	"key" : "green",
	    	"val" : "green"
	}],
	companyCodes: [{
	    	"key" : "PROSELY",
	    	"val" : "PROSELY"
	    },{
	    	"key" : "ASSISTIX",
	    	"val" : "ASSISTIX"
	    },{
	    	"key" : "VORATAK",
	    	"val" : "VORATAK"
	    },{
	    	"key" : "CANDECOR",
	    	"val" : "CANDECOR"
	    },{
	    	"key" : "BARKARAMA",
	    	"val" : "BARKARAMA"
	    },{
	    	"key" : "STOCKPOST",
	    	"val" : "STOCKPOST"
	    },{
	    	"key" : "MICROLUXE",
	    	"val" : "MICROLUXE"
	    },{
	    	"key" : "SHADEASE",
	    	"val" : "SHADEASE"
	    },{
	    	"key" : "ZENTIA",
	    	"val" : "ZENTIA"
	    },{
	    	"key" : "GRONK",
	    	"val" : "GRONK"
		},{
	    	"key" : "INTRADISK",
	    	"val" : "INTRADISK"
	}],
	favoriteFruitCodes: [{
	    	"key" : "apple",
	    	"val" : "apple"
	    },{
	    	"key" : "strawberry",
	    	"val" : "strawberry"
	    },{
	    	"key" : "banana",
	    	"val" : "banana"
	}],
    init : function(view, request) {
    	var this_ = this;

    	// 1. initialize buttons
    	N(".searchBox a", view).button();

    	// 2. initialize N.select and bind data for search box inputs
    	// 2. initialize N.select and bind select data
    	// 2-1. create #gender select
		N(this.genderCodes).select(N("#detail #gender", view)).bind().val("male");
		// 2-2. create #eyeColor select
		N(this.eyeColorCodes).select(N("#detail #eyeColor", view)).bind();
		// 2-3. create #company select
		N(this.companyCodes).select(N("#detail #company", view)).bind();
		// 2-4. create #favoriteFruit select
		N(this.favoriteFruitCodes).select(N("#detail #favoriteFruit", view)).bind();

		// 3. initialize forms
    	// 3-1. initialize search form and add new row data
    	var searchForm = N([]).form({
    		context : N("div.searchBox li.inputs", view)
    	}).add();
    	// 3-2. initialize detail form
    	var detailForm = N([]).form({
    		context : N("#detail", view),
    		revert : true
    	});

    	// 4. initialize N.grid and bind empty data for data list
    	var this_ = this;
    	var grid = N([]).grid({
       		context : N("#grid", view),
       		data : [],
       		height : 500,
       		resizable : true,
       		sortable : true,
       		addSelect : false,
       		hover : true,
       		select : true,
       		addTop : true,
       		onSelect : function(index, rowEle, data, beforeRow) {
       			// Grid row select event
       			if(index > -1) {
	       			// do validate;
	       			// detailForm.row() = -1 is unbind flag
	       			if(detailForm.row() > -1) {
		       			if(!detailForm.validate()) {
		       				return false;
		       			}
	       			}

	  				if(detailForm.context().hasClass("row_data_changed__")) {
	  					if(index !== detailForm.row()) {
	  						N(window).alert({
		      					msg : N.message.get(this_.messages, "editr"),
		      					confirm : true,
		      					onOk : function() {
		      						// 5. bind data to detail form;
		      						detailForm.bind(index, data);
		      						rowEle.click();
		      					}
		      				}).show();
	  					}
	  					return false;
	      			} else {
	      				// 5. bind data to detail form;
	      				detailForm.bind(index, data);
	      			}
       			}

        	}
       	});

    	var retrDataNBind = function() {
    		// Temporary code
  			N(searchForm.data()).comm("html/apid/data/grid.json").submit(function(data) {
  				// N.grid bind
           		grid.bind(data);
           		// bind first row data to detail form;
           		if(data.length > 0) {
           			detailForm.unbind();
           			detailForm.bind(0, grid.data(false));
           		}
           	});
    	}

    	// 6. bind events
    	// 6-1. Search button
    	N("#btnSearch", view).click(function(e) {
            e.preventDefault();
            if(searchForm.validate()) {
   				retrDataNBind();
            }
        }).click(); // Auto retrieve

    	// 6-2. Save button
    	N("#btnSave", view).click(function(e) {
    		e.preventDefault();

            if(grid.data("modified").length === 0) {
            	N(window).alert(N.message.get(this_.messages, "ncddt")).show();
            	return false;
            }

         	// do validate;
         	// detailForm.row() = -1 is unbind flag
            if(detailForm.row() > -1) {
            	if(!detailForm.validate()) {
            		return false;
            	}
            }

           	N(window).alert({
           		msg : N.message.get(this_.messages, "save"),
           		confirm : true,
           		onOk : function() {
           			N(window).alert({
               			title : N.message.get(this_.messages, "sentp"),
               			msg : "<pre style='width: 450px; height: 400px; overflow: auto;'>" + N.json.format(grid.data("modified")).replace(/\\/g, "") + "</pre>"
               		}).show();
           		}
           	}).show();
    	});

    	// 6-3 New button
    	N("#btnAdd", view).click(function(e) {
    		e.preventDefault();
    		if(detailForm.validate()) {
    			// Unbind form
	    		detailForm.unbind();
	    		// Add row
	    		detailForm.add();

	    		// When the row data is empty
    			if(grid.data().length === 0) {
    				grid.bind(detailForm.data(false));
    			}
    		}
    	});

    	// 6-4 Delete button
    	N("#btnDelete", view).click(function(e) {
    		e.preventDefault();
    		// Remove row of N.grid
            grid.remove(detailForm.row());
         	// Unbind form
            detailForm.bind();
    	});

    	// 6-5 Revert button
    	N("#btnRevert", view).click(function(e) {
    		e.preventDefault();

    		if(grid.data("modified").length === 0) {
            	N(window).alert(N.message.get(this_.messages, "ncddt")).show();
            	return false;
            }

    		detailForm.revert();
    	});
    },
    messages : {
		"ko_KR" : {
			"ncddt" : "변경된 데이터가 없습니다.",
			"save" : "저장 하겠습니까?",
			"editr" : "데이터를 수정 중 입니다. 선택한 행의 데이터를 조회 하겠습니까?",
			"edits" : "데이터를 수정 중 입니다. 조회 하겠습니까?",
			"sentp" : "서버로 전송되는 파라미터"
		},
		"en_US" : {
			"ncddt" : "No changed data",
			"save" : "Do you want to save?",
			"editr" : "You are on the editing the data. are you sure you want to retrieve the data from the selected row?",
			"edits" : "You are on the editing the data. are you sure retrieve the data?",
			"sentp" : "sent parameters to the server"
		}
	}
});
</script>