<article class="exap0500 view-code" >
	<h1>그리드 입력(C) 조회(R) 수정(U) 삭제(D) 예제(리스트형)</h1>
	<div class="intro">
		<p class="smallContTit">데이터 목록 화면에서 직접 입력 조회 수정 삭제를 처리하는 예제 입니다(체크박스로 행을 선택하여 삭제).</p>
		<p class="smallContTit">서버와 연계되지 않은 UI 쪽 코딩 예제 입니다. 때문에 검색 조건으로 입력한 데이터는 그리드에 적용되지 않습니다. 서버쪽으로 전달되는 파라미터만 확인 바랍니다.</p>
		<p class="smallContTit">서버에서는 브라우저에서 POST로 전달된 JSON 문자열 데이터를 변환하여 파라미터로 사용하면 됩니다.</p>
		<p class="smallContTit">그리드의 모양과 스타일은 natural.ui.css 에서 바꿀 수 있습니다. 사이트 디자인에 맞게 수정 하기 바랍니다.</p>
		<p class="smallContTit">그리드 옵션의 filter 속성이 false인 상태에서 thead의 th에  data-filter="string|number|date" 속성을 지정하면 지정한 컬럼만 데이터 필터를 활성화 할 수 있습니다.</p>
	</div>

	<div class="searchBox">
		<ul>
			<li class="inputs">
				<label>Name<input id="name" type="text" data-validate='[["alphabet+integer"]]' /></label>
				<label>Gender<input id="gender" type="radio" /></label>
				<label>Eye Color<select id="eyeColor"><option>선택</option></select></label>
			</li>
			<li class="buttons">
				<a id="btnAdd" href="#" data-opts='{ "color": "green" }'>추가</a>
				<a id="btnDelete" href="#" data-opts='{ "color": "green" }'>삭제</a>
				<a id="btnSave" href="#" data-opts='{ "color" : "gray" }'>저장</a>
				<a id="btnSearch" href="#">조회</a>
			</li>
		</ul>
	</div>

	<table id="grid" class="grid" style="width: 100%;">
		<colgroup>
			<col style="width: 50px;">
			<col style="width: 100px;">
			<col style="width: auto;">
			<col style="width: 70px;">
			<col style="width: 90px;">
			<col style="width: 50px;">
			<col style="width: 110px;">
			<col style="width: 60px;">
		</colgroup>
		<thead>
			<tr>
				<th><input id="checkAll" type="checkbox" title="하위 체크박스 모두 선택"></th>
				<th>Name</th>
				<th data-filter="true">Email</th>
				<th data-filter="true">Gender</th>
				<th data-filter="true">Eye Color</th>
				<th data-filter="true">Age</th>
				<th data-filter="true">Registered</th>
				<th data-filter="true">Active</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td align="center"><input class="checkAllTarget" type="checkbox" title="마이링크 선택" /></td>
				<td><input id="name" type="text" data-validate='[["required"]]' /></td>
				<td><input id="email" type="text" data-validate='[["required"], ["email"]]' /></td>
				<td align="center">
					<select id="gender">
						<option>선택</option>
					</select>
				</td>
				<td align="center">
					<select id="eyeColor" data-validate='[["required"]]'>
						<option>선택</option>
					</select>
				</td>
				<td><input id="age" type="text" data-validate='[["required"], ["integer"]]' /></td>
				<td><input id="registered" type="text" data-format='[["date", 8, "date"]]' /></td>
				<td align="center"><input id="isActive" type="checkbox" /></td>
			</tr>
		</tbody>
	</table>
</article>

<script type="text/javascript">
N(".exap0500").cont({
	genderCodes : [{
     	"key" : "male",
     	"val" : "male"
     },{
     	"key" : "female",
     	"val" : "female"
    }],
	eyeColorCodes : [{
     	"key" : "blue",
     	"val" : "blue"
     },{
     	"key" : "brown",
     	"val" : "brown"
     },{
     	"key" : "green",
     	"val" : "green"
	}],
    init : function(view, request) {
    	// 1. initialize buttons
    	N(".buttons a", view).button();

    	// 2. initialize N.select and bind data for search box inputs
    	// 2-1. create #gender select
		N(this.genderCodes).select(N("div.searchBox li.inputs #gender", view)).bind();
		N(this.genderCodes).select(N("table.grid tbody #gender", view)).bind();
		// 2-2. create #eyeColor select
		N(this.eyeColorCodes).select(N("div.searchBox li.inputs #eyeColor", view)).bind();
		N(this.eyeColorCodes).select(N("table.grid tbody #eyeColor", view)).bind();

    	// 3. initialize N.form and add new row data for search box
    	var form = N([]).form({
    		context : N("div.searchBox li.inputs", view),
    		revert : true
    	}).add();

    	// 4. initialize N.grid and bind empty data for data list
    	var grid = N([]).grid({
       		context : N("table#grid", view),
       		resizable : true,
       		sortable : true,
       		hover : true,
       		checkAll : "#checkAll",
			checkAllTarget : ".checkAllTarget"
       	}).bind();

    	// 5. bind events
    	// 5-1. Search button
    	N("#btnSearch", view).click(function(e) {
            e.preventDefault();
            if(form.validate()) {
    			N(form.data()).comm("html/apid/data/grid.json").submit(function(data, request) {
             		// Data bind by N.grid
             		grid.bind(data.splice(0, 15));
             	});
            }
        });
    	// 5-2. Add button
    	N("#btnAdd", view).click(function(e) {
            e.preventDefault();
            grid.add();
    	});
    	// 5-3. Delete button
    	N("#btnDelete", view).click(function(e) {
            e.preventDefault();
            var checkedIndexs = grid.check();
            if(checkedIndexs.length > 0) {
	            N(window).alert({
	        		msg : "삭제 하시겠습니까?<br/>저장버튼을 누르기 전까지는 서버에 적용되지 않습니다.",
	        		confirm : true,
	        		onOk : function() {
	        			$(checkedIndexs).each(function() {
	        				grid.remove(this);
						});
	        		}
	        	}).show();
            } else {
				N(window).alert("선택된 행이 없습니다.").show();
			}
    	});
    	// 5-4. Save delete
    	N("#btnSave", view).click(function(e) {
            e.preventDefault();

            if(grid.data("modified").length === 0) {
            	N(window).alert("변경된 데이터가 없습니다.").show();
            	return false;
            }

            if(grid.validate()) {
            	N(window).alert({
            		msg : "저장 하시겠습니까?",
            		confirm : true,
            		onOk : function() {
            			N(window).alert({
                 			title : "서버로 전송되는 파라미터",
                 			msg : "<pre style='width: 450px; height: 400px; overflow: auto;'>" + N.json.format(grid.data("modified")).replace(/\\/g, "") + "</pre>"
                 		}).show();
            		}
            	}).show();
            }
    	});
    }
});
</script>